geoip2 /usr/share/GeoIP/GeoLite2-Country.mmdb {
    auto_reload 1d;
    $ip_country_code source=$remote_addr country iso_code;
    $ip_country_name source=$remote_addr country names en;
}

geoip2 /usr/share/GeoIP/GeoLite2-ASN.mmdb {
    auto_reload 1d;
    $ip_asn      source=$remote_addr autonomous_system_number;
    $ip_aso      source=$remote_addr autonomous_system_organization;
}

server {
    listen                 80 default_server;
    listen            [::]:80 default_server;
    server_name                            _;
    root                            /var/www;
    add_header      X-Powered-By       "ipinfo.tw/github";

    set $ip_country "$ip_country_code / $ip_country_name";
    set $ip_as      "AS$ip_asn / $ip_aso";

    location /github {
        return 301      https://github.com/PeterDaveHello/ipinfo.tw;
    }
    location /ip {
        return 200      "$remote_addr\n";
    }
    location /country {
        return 200      "$ip_country\n";
    }
    location /country_code {
        return 200      "$ip_country_code\n";
    }
    location /country_name {
        return 200      "$ip_country_name\n";
    }
    location /as {
        return 200      "$ip_as\n";
    }
    location /asn {
        return 200      "AS$ip_asn\n";
    }
    location /as_desc {
        return 200      "$ip_aso\n";
    }
    location / {
        return 200      "$remote_addr\n$ip_country\n$ip_as\n$http_user_agent\n";
    }

    access_log     /var/log/nginx/access.log;
    error_log  /var/log/nginx/error.log warn;
}
